BEGIN
BEGIN 
EXECUTE IMMEDIATE 'CREATE TABLE 
"__EFMigrationsHistory" (
    "MigrationId" NVARCHAR2(150) NOT NULL,
    "ProductVersion" NVARCHAR2(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
)';
END;
EXCEPTION
WHEN OTHERS THEN
    IF(SQLCODE != -942)THEN
        RAISE;
    END IF;
END;
/

BEGIN 
EXECUTE IMMEDIATE 'CREATE TABLE 
"contrato" (
    "ID" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL,
    "qn_tipoContrato" NUMBER(10) NOT NULL,
    "txt_numProceso" NVARCHAR2(2000),
    "qn_tipoProceso" NUMBER(10) NOT NULL,
    "qn_vigenciaContrato" NUMBER(10) NOT NULL,
    "dt_fechaSuscripcion" TIMESTAMP(7) NOT NULL,
    "dt_fechaInicio" TIMESTAMP(7) NOT NULL,
    "dt_fechaFin" TIMESTAMP(7) NOT NULL,
    "vm_montoAdjudicado" BINARY_DOUBLE NOT NULL,
    "bol_recurrencia" NUMBER(1) NOT NULL,
    "qn_proveedor" NUMBER(10) NOT NULL,
    "txt_objetoContratacion" NVARCHAR2(2000),
    "qn_unidadConsolidadora" NUMBER(10) NOT NULL,
    "txt_nombreDelegado" NVARCHAR2(2000),
    "txt_nombreAdministrador" NVARCHAR2(2000),
    "txt_nombreTecnicoExterno" NVARCHAR2(2000),
    "dt_fechaUltimoCambio" TIMESTAMP(7) NOT NULL,
    CONSTRAINT "PK_contrato" PRIMARY KEY ("ID")
)';
END;
/

BEGIN 
EXECUTE IMMEDIATE 'CREATE TABLE 
"Seccion" (
    "seccionID" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL,
    "txt_nombreSeccion" NVARCHAR2(2000),
    "txt_detalleSeccion" NVARCHAR2(2000),
    CONSTRAINT "PK_Seccion" PRIMARY KEY ("seccionID")
)';
END;
/

BEGIN 
EXECUTE IMMEDIATE 'CREATE TABLE 
"Tipo" (
    "tipoID" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL,
    "txt_nombreTipo" NVARCHAR2(2000),
    "txt_detalleTipo" NVARCHAR2(2000),
    "seccionId" NUMBER(10) NOT NULL,
    CONSTRAINT "PK_Tipo" PRIMARY KEY ("tipoID"),
    CONSTRAINT "FK_Tipo_Seccion_seccionId" FOREIGN KEY ("seccionId") REFERENCES "Seccion" ("seccionID") ON DELETE CASCADE
)';
END;
/

CREATE INDEX "IX_Tipo_seccionId" ON "Tipo" ("seccionId")
/

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES (N'20191224214437_InitialCreate', N'2.1.11-servicing-32099')
/

BEGIN 
EXECUTE IMMEDIATE 'CREATE TABLE 
"acta" (
    "ID" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL,
    "qn_tipoActa" NUMBER(10) NOT NULL,
    "txt_codigoActa" NVARCHAR2(2000),
    "dt_fechaActa" TIMESTAMP(7) NOT NULL,
    "txt_archivoActa" NVARCHAR2(2000),
    "dt_fechaUltimoCambio" TIMESTAMP(7) NOT NULL,
    "contratoID" NUMBER(10) NOT NULL,
    CONSTRAINT "PK_acta" PRIMARY KEY ("ID"),
    CONSTRAINT "FK_acta_contrato_contratoID" FOREIGN KEY ("contratoID") REFERENCES "contrato" ("ID") ON DELETE CASCADE
)';
END;
/

BEGIN 
EXECUTE IMMEDIATE 'CREATE TABLE 
"entregable" (
    "ID" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL,
    "qn_tipoEntregable" NUMBER(10) NOT NULL,
    "qn_cantidadEntregable" NUMBER(10) NOT NULL,
    "dt_fechaEntregable" TIMESTAMP(7) NOT NULL,
    "txt_archivoEntregable" NVARCHAR2(2000),
    "txt_descripcionEntregable" NVARCHAR2(2000),
    "dt_fechaUltimoCambio" TIMESTAMP(7) NOT NULL,
    "contratoID" NUMBER(10) NOT NULL,
    CONSTRAINT "PK_entregable" PRIMARY KEY ("ID"),
    CONSTRAINT "FK_entregable_contrato_contratoID" FOREIGN KEY ("contratoID") REFERENCES "contrato" ("ID") ON DELETE CASCADE
)';
END;
/

BEGIN 
EXECUTE IMMEDIATE 'CREATE TABLE 
"formaPago" (
    "ID" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL,
    "qn_tipoPago" NUMBER(10) NOT NULL,
    "txt_archivoPago" NVARCHAR2(2000),
    "dt_fechaUltimoCambio" TIMESTAMP(7) NOT NULL,
    "contratoID" NUMBER(10) NOT NULL,
    CONSTRAINT "PK_formaPago" PRIMARY KEY ("ID"),
    CONSTRAINT "FK_formaPago_contrato_contratoID" FOREIGN KEY ("contratoID") REFERENCES "contrato" ("ID") ON DELETE CASCADE
)';
END;
/

BEGIN 
EXECUTE IMMEDIATE 'CREATE TABLE 
"garantia" (
    "ID" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL,
    "qn_tipoGarantia" NUMBER(10) NOT NULL,
    "vm_valorGarantia" BINARY_DOUBLE NOT NULL,
    "txt_codigoGarantia" NVARCHAR2(2000),
    "txt_proveedorGarantia" NVARCHAR2(2000),
    "dt_inicioGarantia" TIMESTAMP(7) NOT NULL,
    "dt_finGarantia" TIMESTAMP(7) NOT NULL,
    "txt_archivoGarantia" NVARCHAR2(2000),
    "dt_fechaUltimoCambio" TIMESTAMP(7) NOT NULL,
    "contratoID" NUMBER(10) NOT NULL,
    CONSTRAINT "PK_garantia" PRIMARY KEY ("ID"),
    CONSTRAINT "FK_garantia_contrato_contratoID" FOREIGN KEY ("contratoID") REFERENCES "contrato" ("ID") ON DELETE CASCADE
)';
END;
/

BEGIN 
EXECUTE IMMEDIATE 'CREATE TABLE 
"informe" (
    "ID" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL,
    "qn_tipoInforme" NUMBER(10) NOT NULL,
    "txt_codigoInforme" NVARCHAR2(2000),
    "dt_fechaInforme" TIMESTAMP(7) NOT NULL,
    "txt_archivoInforme" NVARCHAR2(2000),
    "dt_fechaUltimoCambio" TIMESTAMP(7) NOT NULL,
    "contratoID" NUMBER(10) NOT NULL,
    CONSTRAINT "PK_informe" PRIMARY KEY ("ID"),
    CONSTRAINT "FK_informe_contrato_contratoID" FOREIGN KEY ("contratoID") REFERENCES "contrato" ("ID") ON DELETE CASCADE
)';
END;
/

BEGIN 
EXECUTE IMMEDIATE 'CREATE TABLE 
"modificacion" (
    "ID" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL,
    "qn_tipoModificacion" NUMBER(10) NOT NULL,
    "txt_motivoModificacion" NVARCHAR2(2000),
    "dt_fechaUltimoCambio" TIMESTAMP(7) NOT NULL,
    "contratoID" NUMBER(10) NOT NULL,
    CONSTRAINT "PK_modificacion" PRIMARY KEY ("ID"),
    CONSTRAINT "FK_modificacion_contrato_contratoID" FOREIGN KEY ("contratoID") REFERENCES "contrato" ("ID") ON DELETE CASCADE
)';
END;
/

BEGIN 
EXECUTE IMMEDIATE 'CREATE TABLE 
"multa" (
    "ID" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL,
    "qn_tipoMulta" NUMBER(10) NOT NULL,
    "vm_montoMulta" BINARY_DOUBLE NOT NULL,
    "txt_motivoMulta" NVARCHAR2(2000),
    "dt_fechaMulta" TIMESTAMP(7) NOT NULL,
    "dt_fechaUltimoCambio" TIMESTAMP(7) NOT NULL,
    "txt_codigoInforme" NVARCHAR2(2000),
    "contratoID" NUMBER(10) NOT NULL,
    CONSTRAINT "PK_multa" PRIMARY KEY ("ID"),
    CONSTRAINT "FK_multa_contrato_contratoID" FOREIGN KEY ("contratoID") REFERENCES "contrato" ("ID") ON DELETE CASCADE
)';
END;
/

BEGIN 
EXECUTE IMMEDIATE 'CREATE TABLE 
"vencimientos" (
    "ID" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL,
    "dt_fechaVencimiento" TIMESTAMP(7) NOT NULL,
    "qn_diasAnticipacion" NUMBER(10) NOT NULL,
    "qn_frecuenciaAnticipacion" NUMBER(10) NOT NULL,
    "dt_fechaUltimoCambio" TIMESTAMP(7) NOT NULL,
    "contratoID" NUMBER(10) NOT NULL,
    CONSTRAINT "PK_vencimientos" PRIMARY KEY ("ID"),
    CONSTRAINT "FK_vencimientos_contrato_contratoID" FOREIGN KEY ("contratoID") REFERENCES "contrato" ("ID") ON DELETE CASCADE
)';
END;
/

BEGIN 
EXECUTE IMMEDIATE 'CREATE TABLE 
"pago" (
    "ID" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL,
    "qn_porcentajePago" BINARY_FLOAT NOT NULL,
    "vm_montoPago" BINARY_DOUBLE NOT NULL,
    "dt_tentativaPago" TIMESTAMP(7) NOT NULL,
    "dt_realPago" TIMESTAMP(7) NOT NULL,
    "txt_comprobantePago" NVARCHAR2(2000),
    "dt_fechaUltimoCambio" TIMESTAMP(7) NOT NULL,
    "formaPagoID" NUMBER(10) NOT NULL,
    CONSTRAINT "PK_pago" PRIMARY KEY ("ID"),
    CONSTRAINT "FK_pago_formaPago_formaPagoID" FOREIGN KEY ("formaPagoID") REFERENCES "formaPago" ("ID") ON DELETE CASCADE
)';
END;
/

BEGIN 
EXECUTE IMMEDIATE 'CREATE TABLE 
"fechaModificado" (
    "ID" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL,
    "dt_fechaAnterior" TIMESTAMP(7) NOT NULL,
    "dt_fechaActual" TIMESTAMP(7) NOT NULL,
    "modificacionID" NUMBER(10) NOT NULL,
    CONSTRAINT "PK_fechaModificado" PRIMARY KEY ("ID"),
    CONSTRAINT "FK_fechaModificado_modificacion_modificacionID" FOREIGN KEY ("modificacionID") REFERENCES "modificacion" ("ID") ON DELETE CASCADE
)';
END;
/

BEGIN 
EXECUTE IMMEDIATE 'CREATE TABLE 
"valorModificado" (
    "ID" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL,
    "vm_valorAnterior" BINARY_DOUBLE NOT NULL,
    "vm_valorActual" BINARY_DOUBLE NOT NULL,
    "modificacionID" NUMBER(10) NOT NULL,
    CONSTRAINT "PK_valorModificado" PRIMARY KEY ("ID"),
    CONSTRAINT "FK_valorModificado_modificacion_modificacionID" FOREIGN KEY ("modificacionID") REFERENCES "modificacion" ("ID") ON DELETE CASCADE
)';
END;
/

CREATE INDEX "IX_acta_contratoID" ON "acta" ("contratoID")
/

CREATE INDEX "IX_entregable_contratoID" ON "entregable" ("contratoID")
/

CREATE UNIQUE INDEX "IX_fechaModificado_modificacionID" ON "fechaModificado" ("modificacionID")
/

CREATE UNIQUE INDEX "IX_formaPago_contratoID" ON "formaPago" ("contratoID")
/

CREATE INDEX "IX_garantia_contratoID" ON "garantia" ("contratoID")
/

CREATE INDEX "IX_informe_contratoID" ON "informe" ("contratoID")
/

CREATE INDEX "IX_modificacion_contratoID" ON "modificacion" ("contratoID")
/

CREATE INDEX "IX_multa_contratoID" ON "multa" ("contratoID")
/

CREATE INDEX "IX_pago_formaPagoID" ON "pago" ("formaPagoID")
/

CREATE UNIQUE INDEX "IX_valorModificado_modificacionID" ON "valorModificado" ("modificacionID")
/

CREATE INDEX "IX_vencimientos_contratoID" ON "vencimientos" ("contratoID")
/

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES (N'20191225215128_TablasCreadas', N'2.1.11-servicing-32099')
/

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES (N'20191225230418_AgregarTablaSeccion', N'2.1.11-servicing-32099')
/

ALTER TABLE "vencimientos" ADD "txt_nombreSeccion" NVARCHAR2(2000)
/

ALTER TABLE "vencimientos" ADD "txt_nombreTipo" NVARCHAR2(2000)
/

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES (N'20191226005358_Agrego-Columnas-Vencimiento', N'2.1.11-servicing-32099')
/

